
# –û–±–∑–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –≤ Kubernetes

## üì¶ –ó–∞—á–µ–º –Ω—É–∂–Ω—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è?

–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ ¬´–∑–∞–ª–∏—Ç—å –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä¬ª. –û—Å–æ–±–µ–Ω–Ω–æ –≤ –º–∏—Ä–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤, –≥–¥–µ –≤–∞–∂–Ω–æ:
- –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π,
- —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏,
- –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

–ò–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å –≤—Å—Ç—É–ø–∞—é—Ç –≤ –∏–≥—Ä—É **—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è**.

---

## ‚öôÔ∏è –ë–∞–∑–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

### üîÅ RollingUpdate (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
**–ü–ª–∞–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ø–æ –æ–¥–Ω–æ–º—É –ø–æ–¥—É —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–æ–≤–æ–π.

‚úÖ –ü–ª—é—Å—ã:
- –ú–∏–Ω–∏–º—É–º –ø—Ä–æ—Å—Ç–æ—è,
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞,
- –ü—Ä–æ—Å—Ç–∞ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

‚ö†Ô∏è –ú–∏–Ω—É—Å—ã:
- –†–∏—Å–∫ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–π,
- –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ readiness/liveness-–ø—Ä–æ–± –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

```yaml
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 25%
    maxUnavailable: 25%
```

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
- `minReadySeconds`: —Å–∫–æ–ª—å–∫–æ –ø–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ Ready –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
- `progressDeadlineSeconds`: —Ç–∞–π–º–∞—É—Ç –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—Å–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

---

### üîÑ Recreate
**–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫**: —Å–Ω–∞—á–∞–ª–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Å—Ç–∞—Ä—ã–µ –ø–æ–¥—ã, –ø–æ—Ç–æ–º –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ.

‚úÖ –ü–ª—é—Å—ã:
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è,
- –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏.

‚ö†Ô∏è –ú–∏–Ω—É—Å—ã:
- –î–∞—É–Ω—Ç–∞–π–º (–ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è).

–ö–æ–≥–¥–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç:
- –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è,
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î,
- –î–æ–ø—É—Å—Ç–∏–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø—Ä–æ—Å—Ç–æ–π.

```yaml
strategy:
  type: Recreate
```

---

## üöÄ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

### üü¶üü© Blue-Green Deployment
**–î–≤–µ —Å—Ä–µ–¥—ã**: Blue (—Ç–µ–∫—É—â–∞—è) –∏ Green (–Ω–æ–≤–∞—è). –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ.

‚úÖ –ü–ª—é—Å—ã:
- –ù—É–ª–µ–≤–æ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è,
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–∞—Ç.

‚ö†Ô∏è –ú–∏–Ω—É—Å—ã:
- –£–¥–≤–æ–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã,
- –ù—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–≤—É–º—è —Å—Ä–µ–¥–∞–º–∏.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –≤–∞–∂–Ω–∞:
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è,
- –ì–∞—Ä–∞–Ω—Ç–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

---

### üê§ Canary Deployment
**–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π —Ä–µ–ª–∏–∑**: —Å–Ω–∞—á–∞–ª–∞ –º–∞–ª–∞—è –¥–æ–ª—è —Ç—Ä–∞—Ñ–∏–∫–∞ ‚Üí –∞–Ω–∞–ª–∏–∑ ‚Üí —É–≤–µ–ª–∏—á–µ–Ω–∏–µ ‚Üí –ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.

‚úÖ –ü–ª—é—Å—ã:
- –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è —Ä–∏—Å–∫–∞,
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å A/B —Ç–µ—Å—Ç–æ–≤,
- –ì–∏–±–∫–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å.

‚ö†Ô∏è –ú–∏–Ω—É—Å—ã:
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏,
- –¢—Ä–µ–±—É–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞.

–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- –í—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º,
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –≤—ã–∫–∞—Ç–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ–∏—á.

---

## üîí –ü—Ä–∏–Ω—Ü–∏–ø—ã –Ω—É–ª–µ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—è

–ß—Ç–æ–±—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–ª–∞ **Zero Downtime**, –≤–∞–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:

- `readinessProbe`: –ø–æ–¥ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≥–æ—Ç–æ–≤—ã–º, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç —ç—Ç—É –ø—Ä–æ–≤–µ—Ä–∫—É.
- `livenessProbe`: –µ—Å–ª–∏ –ø–æ–¥ "–∑–∞–≤–∏—Å", Kubernetes –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ.
- **Graceful Shutdown**:
  - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `SIGTERM`,
  - –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è,
  - –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã.
- `terminationGracePeriodSeconds`: –≤—Ä–µ–º—è –¥–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–¥–∞.
- `Service` –∏ `Ingress`: –æ—Å–Ω–æ–≤–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–æ–º –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## üß† –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é?

| –£—Å–ª–æ–≤–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è |
|--------|-------------------------|
| –ù–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ | Recreate |
| –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞–∂–µ–Ω | RollingUpdate |
| –ö—Ä–∏—Ç–∏—á–Ω–æ –∏–º–µ—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–∞—Ç | Blue-Green |
| –•–æ—Ç–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —á–∞—Å—Ç–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ | Canary |
| Stateless-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | RollingUpdate –∏–ª–∏ Canary |
| Stateful-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | Blue-Green –∏–ª–∏ Recreate |

---

## üßæ –ö–ª—é—á–µ–≤—ã–µ –º—ã—Å–ª–∏

- **Recreate** ‚Äî –ø—Ä–æ—Å—Ç–æ, –Ω–æ —Å –ø—Ä–æ—Å—Ç–æ–µ–º.
- **RollingUpdate** ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- **Blue-Green** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–æ –¥–æ—Ä–æ–≥–æ.
- **Canary** ‚Äî –≥–∏–±–∫–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.
- –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –ø—Ä–æ **readiness/liveness probes** –∏ **graceful shutdown** ‚Äî –æ–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –ª—é–±–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞.
- –í–∞—à–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è = –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å—é, —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏.

---

## üîµüü¢ –û—Å–Ω–æ–≤—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

**Blue-Green Deployment** ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è (green) —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —Ç–µ–∫—É—â–µ–π (blue). –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–µ–ª—ë–Ω–æ–π –≤–µ—Ä—Å–∏–∏, –≤–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è —Å —Å–∏–Ω–µ–π –Ω–∞ –∑–µ–ª—ë–Ω—É—é.

‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏,
- –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç,
- –ù—É–ª–µ–≤–æ–π –ø—Ä–æ—Å—Ç–æ–π.

‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —Ä–µ—Å—É—Ä—Å–æ–≤:
- –î–≤–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å—Ä–µ–¥—ã,
- –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è.

---

## üß™ –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ù–∞—á–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

#### –î–µ–ø–ª–æ–π–º–µ–Ω—Ç (blue)
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app-blue
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-app
      env: blue
  template:
    metadata:
      labels:
        app: my-app
        env: blue
    spec:
      containers:
      - name: my-app
        image: stefanprodan/podinfo:6.7.0
        ports:
        - containerPort: 9898
```

#### Service
```yaml
apiVersion: v1
kind: Service
metadata:
  name: app-service
spec:
  selector:
    app: my-app
    env: blue
  ports:
  - protocol: TCP
    port: 9898
    targetPort: 9898
```

---

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏

–°–æ–∑–¥–∞—ë–º **–∑–µ–ª—ë–Ω—ã–π** –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç:

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app-green
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-app
      env: green
  template:
    metadata:
      labels:
        app: my-app
        env: green
    spec:
      containers:
      - name: my-app
        image: stefanprodan/podinfo:6.7.1
        ports:
        - containerPort: 9898
```

---

### 3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞

–û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä –≤ `Service`, —á—Ç–æ–±—ã —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ `env: green`:

```bash
kubectl patch svc app-service -p '{"spec":{"selector":{"app":"my-app", "env":"green"}}}'
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:
```bash
kubectl port-forward service/app-service 9898
curl localhost:9898/version
# –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏—é 6.7.1
```

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è:
```bash
kubectl patch svc app-service -p '{"spec":{"selector":{"app":"my-app", "env":"blue"}}}'
```

---

## ‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (GitLab CI)

```yaml
deploy-green:
  stage: deploy
  script:
    - kubectl apply -f deployment-green.yaml

test-green:
  stage: test
  script:
    - ./run-tests.sh

switch-traffic:
  stage: deploy
  script:
    - kubectl patch svc app-service -p '{"spec":{"selector":{"env":"green"}}}'
```

---

## üß† –ö–ª—é—á–µ–≤—ã–µ –º—ã—Å–ª–∏

- **Blue-Green** –¥–∞—ë—Ç –±—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç –∏ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫–∏.
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–∏—Å—Ç–µ–º, –≥–¥–µ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º –ø—Ä–æ—Å—Ç–æ–π.
- –¢—Ä–µ–±—É–µ—Ç:
  - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (Prometheus, Grafana),
  - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (Loki),
  - readiness-–ø—Ä–æ–± –∏ graceful shutdown.
- –†–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `Deployment + Service` –∏–ª–∏ `Ingress`.

---

# Canary Deployment –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –≤—ã–ø—É—Å–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Kubernetes

## üê§ –ó–∞—á–µ–º Canary?

Canary Deployment ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ **–Ω–µ–±–æ–ª—å—à–æ–π —á–∞—Å—Ç–∏ —Ç—Ä–∞—Ñ–∏–∫–∞** –ø–µ—Ä–µ–¥ –µ—ë –ø–æ–ª–Ω—ã–º –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º.

‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è —Ä–∏—Å–∫–∞,
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ,
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞**,
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ä–µ–ª–∏–∑–æ–≤.

---

## ‚öôÔ∏è –û—Å–Ω–æ–≤—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç Blue-Green, –≥–¥–µ –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é, Canary:
- **—Ä–∞–∑–¥–µ–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫**, –Ω–∞—á–∏–Ω–∞—è —Å 5‚Äì10%,
- **–º–æ–Ω–∏—Ç–æ—Ä–∏—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏,
- –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ–ª—é —Ç—Ä–∞—Ñ–∏–∫–∞ –¥–æ 100%.

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑:
- –ù–µ—Å–∫–æ–ª—å–∫–æ `Deployment` (primary –∏ canary),
- `Service` –∏ `Ingress` —Å –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏ –¥–ª—è NGINX:
  - `nginx.ingress.kubernetes.io/canary: "true"`
  - `nginx.ingress.kubernetes.io/canary-weight: "10"`

---

## üõ† –ü—Ä–∞–∫—Ç–∏–∫–∞

1. –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º `app-primary` —Å —Ç–µ–∫—É—â–µ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π.
2. –°–æ–∑–¥–∞—ë–º `Service` –∏ `Ingress` –¥–ª—è primary.
3. –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º `app-canary` —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π.
4. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π `Service` –∏ `Ingress` –¥–ª—è canary —Å –≤–µ—Å–æ–º —Ç—Ä–∞—Ñ–∏–∫–∞ (10%, –∑–∞—Ç–µ–º 30%, 90%, 100%).
5. –ü—Ä–æ–≤–æ–¥–∏–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.
6. –ü–æ—Å–ª–µ 100% ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º primary-–¥–µ–ø–ª–æ–π–º–µ–Ω—Ç –∏ —É–¥–∞–ª—è–µ–º canary.

---

## üì¶ –ò–Ω–≥—Ä–µ—Å—Å –¥–ª—è Canary
–ü—Ä–∏–º–µ—Ä –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π:
```yaml
annotations:
  nginx.ingress.kubernetes.io/canary: "true"
  nginx.ingress.kubernetes.io/canary-weight: "30"
```

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞:
- –ü–æ **–∑–∞–≥–æ–ª–æ–≤–∫–∞–º**:
  ```yaml
  nginx.ingress.kubernetes.io/canary-by-header: "X-Canary-User"
  nginx.ingress.kubernetes.io/canary-by-header-value: "true"
  ```
- –ü–æ **–∫—É–∫–∞–º**:
  ```yaml
  nginx.ingress.kubernetes.io/canary-by-cookie: "canary-test"
  ```

---

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Flagger

[Flagger](https://docs.flagger.app) ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ Canary:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Istio, NGINX, Linkerd,
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ —Ä–æ—Å—Ç–µ –æ—à–∏–±–æ–∫ –∏–ª–∏ –∑–∞–¥–µ—Ä–∂–µ–∫,
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Prometheus –¥–ª—è –º–µ—Ç—Ä–∏–∫.

–ü–æ–ª–µ–∑–µ–Ω –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö —Å–∏—Å—Ç–µ–º, –≥–¥–µ –≤–∞–∂–Ω–æ:
- –Ω–∞–¥—ë–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Ä–µ–ª–∏–∑–æ–≤,
- —É—Å—Ç—Ä–∞–Ω—è—Ç—å —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç–æ—Ä,
- —É—Å–∫–æ—Ä—è—Ç—å Time-To-Market.

---

## üß† –ö–ª—é—á–µ–≤—ã–µ –º—ã—Å–ª–∏

- Canary = –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–µ–ª–∏–∑.
- –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –¥–æ–ª–µ–≤–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞.
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–∫–æ–Ω—Ç—Ä–æ–ª—å, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –≥–∏–±–∫–æ—Å—Ç—å**.
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è A/B —Ç–µ—Å—Ç–æ–≤ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–≥—Ä—É–ø–ø.
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è ‚Äî —á–∏—Å—Ç–∏–º –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (—É–¥–∞–ª—è–µ–º Canary).
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–º–æ—â—å—é Flagger.

---
